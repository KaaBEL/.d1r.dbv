<!DOCTYPE html>
<!-- v.0.1.68 -->
<html>
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=2.0" id="viewport" />
    <meta name="description" content="An example of html frontend for External Droneboi Workshop." />
    <link rel="icon" href="https://kaabel.github.io/favicon.png" type="image/png" />
    <link rel="icon shortcut" href="https://kaabel.github.io/favicon.svg" type="image/svg+xml" />
    <title>Droneboi external workshop</title>
    <link rel="canonical" href="https://kaabel.github.io/.d1r.dbv/workshop.html" />
    <style>
body {
  margin: 5px 0 0 0;
  background-color: #000c1c;
  font-family: sans-serif;
}
main {
  display: flex;
  flex-wrap: wrap;
  margin: 40px 10px 10px 0;
}
.cell {
  display: flex;
  flex: 320px;
  height: 208px;
  padding: 5px;
  margin: 10px 0 0 10px;
}
.spacer {
  flex: 320px;
  height: 0px;
  padding: 0 5px;
  border: 2px solid #000c1c;
  border-top-width: 0;
  border-bottom-width: 0;
  margin-left: 10px;
}
div.blank {
  background-color: #888;
  width: 144px;
  min-width: 144px;
  height: 208px;
}
.cell span {
  position: absolute;
  left: 149px;
  transform: translate(-100%, 0);
  padding: 5px;
  border-radius: 5px;
  background-color: #010510;
  color: #deeaf8;
}
.cell img {
  flex-grow: 0;
}
.content {
  position: relative;
  flex-grow: 2;
  padding: 5px;
  margin-left: 5px;
  border-radius: 5px;
  background-color: #0a1e36;
}
.content h1, #menu h1 {
  position: absolute;
  left: 50%;
  transform: translate(-48%, -25px);
  max-width: 100%;
  font-weight: normal;
  color: #dbecff;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}
.content p {
  margin-top: 35px;
  height: 124px;
  max-height: 124px;
  color: #a5c7ed;
  overflow: hidden;
  word-break: break-word;
}
.content footer {
  color: #4e7eaf;
  text-align: center;
}
#search input {
  width: 100%;
  padding: 9px 3px;
  margin: 5px 5px 0 5px;
  border: 2px solid #14263c;
  border-radius: 5px;
  background-color: #031021;
  color: #a5c7ed;
  font-size: large;
}
#search input::placeholder {
  color: #14263c;
  font-style: italic;
}
#search {
  position: fixed;
  top: 0;
  width: 100%;
}
#search div {
  position: relative;
  padding-right: 35px;
}
.scrl {
  height: 100%;
  max-height: calc(100dvh - 5px);
  overflow-x: hidden;
  overflow-y: scroll;
}
.scrl::-webkit-scrollbar {
  width: 10px;
  border-radius: 7px;
  background-color: #0c243c;
}
.scrl::-webkit-scrollbar-thumb {
  border-radius: 7px;
  background-color: #9bc9fb;
}
.cell:active, .cell:active .content, #menu button:active {
  background-color: #4782bc;
}
#menu {
  display: none;
  position: fixed;
  top: 0;
  width: 100%;
  width: 100dvw;
  height: 100%;
  height: 100dvh;
  background-color: #031021e3;
}
#menu section {
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 1024px;
  height: 720px;
  max-width: 95%;
  max-height: 95%;
  overflow: auto;
}
#menu section, section.cell, #menu button {
  position: relative;
  border: 2px solid #4782bc;
  border-radius: 5px;
  background-color: #0c243c;
}
#menu section h1 {
  position: absolute;
  transform: translate(-50%, -10px);
}
#menu #menu_close {
  position: absolute;
  right: 0;
  margin: 5px;
  padding: 5px;
}
#vehicle_thumbnail {
  width: 288px;
  height: 416px;
  background-color: #4782bc;
  image-rendering: pixelated;
}
#menu div {
  padding: 45px 10px 10px 10px;
  column-width: 325px;
  color: #a5c7ed;
}
#menu h2 {
  margin: 10px 0;
  font-weight: normal;
}
#vehicle_description {
  margin-bottom: 10px;
}
/* body.ratio2 {
  width: 200%;
  height: 200%;
}
.ratio2 .scrl {
  max-height: calc(200% - 10px);
}
html:has(body.ratio2) {
  overflow: hidden;
} */
    </style>
    <script>
      if (devicePixelRatio > 1)
        (document.getElementById("viewport") || fallbackEl).content =
          "width=device-width, initial-scale=" +
          (1 / devicePixelRatio).toFixed(1);</script>
  </head>
  <body>
    <div class="scrl">
      <main id="vehicleList"></main>
    </div>
    <div id="search">
      <div>
        <input id="input" type="text" placeholder="Search..." />
      </div>
    </div>
    <div id="menu" class="tab">
      <section class="scrl">
        <h1 id="vehicle_name"></h1>
        <button id="menu_close">
          <svg xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0,0,16,16" height="24" width="24">
            <g style="mix-blend-mode: normal" stroke-linecap="round" stroke-width="3" stroke="#dbecfe" fill-rule="nonzero">
              <path d="M1.5,1.5l13,13M1.5,14.5l13,-13" />
            </g>
          </svg>
        </button>
        <div>
          <img id="vehicle_thumbnail" alt="[vehicle.thubnail]" />
          <article id="vehicle_description">
            <h2>Description:</h2>
          </article>
          <button>Edit</button>
          <button>Like</button>
          <button>Trash</button>
          <button>Report</button>
          <h2>Creator:</h2>
          <p id="vehicle_creator"></p>
          <h2>Class:</h2>
          <p id="vehicle_class"></p>
          <h2>Subclasses:</h2>
          <p id="vehicle_subclass"></p>
          <h2>Tags:</h2>
          <p id="vehicle_tags"></p>
        </div>
      </section>
    </div>
    <script>
      var vehicleList = document.getElementById("vehicleList");
      var menu_close = document.getElementById("menu_close");
      var fallbackEl = document.createElement("div");
      var menu = document.getElementById("menu") || fallbackEl;
      var input = document.getElementById("input") || fallbackEl;
      if (!vehicleList)
        throw new Error("vehicleList is missing");

      /** @param {string} id */
      function textNodeToElementById(id) {
        var alt = "[" + id.toLocaleLowerCase().replace(/_/g, ".");
        return (document.getElementById(id) ||
          fallbackEl).appendChild(document.createTextNode(alt + "]"));
      }
      var vehicle = {
        name: textNodeToElementById("vehicle_name"),
        creator: textNodeToElementById("vehicle_creator"),
        thubnail: 
          /** @type {HTMLImageElement} */
          (document.getElementById("vehicle_thumbnail") || fallbackEl),
        description: textNodeToElementById("vehicle_description"),
        class: textNodeToElementById("vehicle_class"),
        subclass: textNodeToElementById("vehicle_subclass")
      }
      if (menu_close)
        menu_close.onclick = function () {
          menu.style.display = "";
        };
      function workshopItemOnclick(data) {
        return function () {
          if (!/workshop[^]*dev/.test(location.href))
            return;
          menu.style.display = "unset";
          vehicle.name.data = data.name;
          vehicle.thubnail.src = data.thubnail;
          vehicle.description.data = data.description;
          vehicle.creator.data = data.creator;
        };
      }
      function addWorkshopItem(thubnail, size, name, description, creator) {
        var section = document.createElement("section");
        span = document.createElement("span");
        span.appendChild(document.createTextNode(size || "Small"))
        section.appendChild(span);
        thubnail ? 
          section.appendChild(document.createElement("img")).src = thubnail :
          section.appendChild(document.createElement("div")).className =
            "blank";
        var div = document.createElement("div");
        div.appendChild(document.createElement("h1")).appendChild(
          document.createTextNode("" + name));
        div.appendChild(document.createElement("p")).appendChild(
          document.createTextNode("" + description));
        div.appendChild(document.createElement("footer")).appendChild(
          document.createTextNode("Made by " + creator));
        section.appendChild(div).className = "content";
        section.onclick = workshopItemOnclick({
          name: name,
          thubnail: thubnail,
          description: description,
          creator: creator
        });
        vehicleList.appendChild(section).className = "cell";
      }
      /** @param {unknown} list */
      function handleVehiclesJSON(list) {
        if (!(list instanceof Array))
          return;
        while (vehicleList.lastChild)
          vehicleList.removeChild(vehicleList.lastChild);
        for (var i = 0, few = 256, item; i < list.length; i++) {
          /** @type {unknown} */
          if (typeof (item = list[i]) !== "object")
            continue;
          addWorkshopItem(
            item.id && few ? "https://exa.toastyx.dev/api/workshop/" +
              item.id + "/thumbnail" : "",
            "grid",
            item.name || "",
            item.description || "",
            item.creator || ""
          );
          few && few--;
        }
        for (var i = 7; i-- > 0;)
          vehicleList.appendChild(
            document.createElement("div")).className = "spacer";
      }
      /** @type {(this: GlobalEventHandlers, ev: KeyboardEvent) => any} */
      function inputEneterHandler(e) {
        if (e.key !== "Enter")
          return;
        /** @type {unknown} */
        var res, xhr = new XMLHttpRequest();
        xhr.open("GET", "https://exa.toastyx.dev/api/workshop/search?q=" +
          (input instanceof HTMLInputElement ? input.value : "Frog"));
        xhr.onreadystatechange = function () {
          if (xhr.readyState !== 4)
            return;
          try {
            res = JSON.parse(xhr.responseText);
          } catch (e) {
            console.error(xhr.responseText ? e : "xhr empty response");
            return;
          }
          handleVehiclesJSON(res);
        };
        xhr.send();
      };
      input.onkeyup = inputEneterHandler;
    </script>
  </body>
</html>
